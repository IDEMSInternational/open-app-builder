<div class="container" *ngIf="!lastReceivedMsg?.isStory">
  <div #messagesContent class="normal-chat">
    <div class="messages">
      <div *ngIf="autoReplyEnabled" class="auto-reply-container">
        <p>Messages Sent {{messagesSent}}</p>
        <p>Messages Received {{messagesReceived}}</p>
        <p>{{debugMsg}}</p>
        <p>{{stringify(messages[messages.length - 1])}}</p>
      </div>
      <div *ngFor="let msg of messages; index as i"
        [class]="msg.sender === 'bot' ? 'msg-container bot-msg' : 'msg-container user-msg'">
        <div *ngIf="msg.character && !sameAsLastCharacter(msg, messages[i - 1])">
          <img *ngIf="msg.character === 'Guide'" src="assets/images/chat-characters/Guide_120.png">
          <img *ngIf="msg.character === 'Neighbour'" src="assets/images/chat-characters/Neighbour_120.png">
          <img *ngIf="msg.character === 'Elder'" src="assets/images/chat-characters/Elder_120.png">
        </div>
        <div class="msg-bubble-container">
          <div class="msg-bubble-triangle" *ngIf="msg.sender === 'bot'">
            <svg width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 20V0L0 10L15 20Z" fill="grey" />
            </svg>
          </div>
          <div class="msg-bubble" [ngClass]="{'large': msg.text.length < 3}">
            {{msg.text}}
          </div>
          <div class="msg-bubble-triangle" *ngIf="msg.sender === 'user'">
            <svg width="15" height="20" viewBox="0 0 15 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 20V0L15 10L0 20Z" fill="darkcyan" />
            </svg>
          </div>
        </div>
        <div *ngFor="let attachment of msg.attachments" class="msg-attachment" [ngSwitch]="attachment.type">
          <img *ngSwitchCase="'image'" [src]="attachment.url">
        </div>
      </div>
      
    </div>
    <div style="display: block; height: 100px"></div>
  </div>
  <div class="response-options">
    <div *ngFor="let option of responseOptions" class="response-option" [ngClass]="{'large': option.text.length < 3}" (click)="selectResponseOption(option)">
      <img *ngIf="option.imageUrl" [src]="option.imageUrl">
      <span>{{option.text}}</span>
    </div>
    <form *ngIf="true"
      (ngSubmit)="onInputSubmit($event)">
      <input [(ngModel)]="inputValue" class="response-option" name="text-response" placeholder="Type other response...">
    </form>
  </div>
  <ion-button *ngIf="triggerPhrase === 'welcome'" class="skip-button" (click)="skipWelcome()">Skip</ion-button>
</div>
<div *ngIf="lastReceivedMsg?.isStory" class="story-chat">
  <h1>{{lastReceivedMsg.text}}</h1>
  <img class="story-image" *ngIf="lastReceivedMsg?.attachments[0]?.type === 'image'" [src]="lastReceivedMsg?.attachments[0].url">
  <div class="response-options">
    <div *ngFor="let option of responseOptions" class="response-option">
      <div *ngIf="option.text.toLowerCase() === 'previous'" (click)="onStoryPreviousClicked()">Previous</div>
      <div *ngIf="option.text.toLowerCase() !== 'previous'" (click)="onStoryNextClicked()">Next</div>
    </div>
  </div>
</div>