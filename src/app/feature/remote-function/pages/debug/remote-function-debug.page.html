<ion-content class="ion-padding">
  <h2>Remote Functions</h2>

  <p>Trigger remote function with data parameters</p>
  <div style="display: flex; gap: 16px">
    <div>
      <h3>Target Function</h3>
      <ion-input
        fill="outline"
        placeholder="Function Name"
        [(ngModel)]="targetFunctionName"
      ></ion-input>
    </div>
    <div>
      <h3>Parameters</h3>
      <div style="display: flex; flex-direction: column; gap: 12px">
        @for (pair of paramPairs(); track $index) {
        <div style="display: flex; gap: 8px; align-items: center">
          <ion-input
            fill="outline"
            placeholder="Key"
            [value]="pair.key()"
            (ionInput)="pair.key.set($any($event.target).value)"
          ></ion-input>
          <ion-input
            fill="outline"
            placeholder="Value"
            [value]="pair.value()"
            (ionInput)="pair.value.set($any($event.target).value)"
          ></ion-input>
          <ion-button fill="clear" (click)="removeParam($index)">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </div>
        }
        <ion-button fill="outline" (click)="addParam()">+ Add Param</ion-button>
      </div>
    </div>
  </div>

  <ion-button
    [disabled]="!targetFunctionName() || requestPending()"
    (click)="triggerFunction(targetFunctionName())"
    >Run</ion-button
  >

  @if(response().data; as responseData){
  <h4>Data</h4>
  <div>{{responseData | json}}</div>
  } @if(response().error; as responseError){
  <h4>Error</h4>
  <div>{{responseError | json}}</div>
  }

  <hr style="background-color: #cacaca; height: 1px; width: 100%; margin: 2em 0" />

  @switch (config.provider) { @case('firebase'){

  <!-- Firebase Provider-->
  @if(config.provider==='firebase'){
  <h2>Firebase Provider</h2>
  <h3>AppCheck Token</h3>
  <p>Firebase uses appcheck to ensure functions only invocated from trusted source</p>

  @if(firebaseToken(); as token){
  <div>✅ Token Available</div>
  <div style="font-size: small">
    @if(token.expireTimeMillis; as expiry){ Expires: {{expiry}} } @else{ Expiry not Available on Web
    }
  </div>
  <ion-button style="margin-top: 1em">Refresh</ion-button>
  } @if(firebaseTokenError(); as tokenError){
  <div>⚠️ Could Not Retrieve Token</div>
  <div style="margin-top: 1em; font-size: small">{{tokenError}}<br /></div>
  <div style="margin-top: 1em">
    Ensure the current app, site or debug token is registered in the firebase console
  </div>

  } } }

  <!-- Default Provider -->
  @default {
  <p>Debug page not configured for provider: {{config.provider}}</p>
  } }

  <hr style="background-color: #cacaca; height: 1px; width: 100%; margin: 2em 0" />
  <h3>Deployment Config</h3>
  <div>{{config | json}}</div>
</ion-content>
